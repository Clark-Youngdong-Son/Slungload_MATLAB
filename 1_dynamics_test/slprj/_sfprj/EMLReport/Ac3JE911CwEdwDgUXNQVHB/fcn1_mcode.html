<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S2T0U3">y</span> = fcn(<span class="var type1" id="S3T1U6">u</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T1:U2"><span class="var type1" id="S4T1U9">n</span> = <span class="var type1" id="S3T1U10">u</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="var type0" id="S5T0U13">X</span> = <span class="message error" id="M1F1C"><span class="var type1" id="S3T1U15">u</span>.x</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="var type0" id="S6T0U19">x</span> = <span class="var type0" id="S5T0U21"><span class="message error" id="M2F1C">X</span></span>(1:<span class="var type0" id="S4T0U25">n</span>/2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="var type0" id="S7T0U29">x_dot</span> = <span class="var type0" id="S5T0U31"><span class="message error" id="M3F1C">X</span></span>(<span class="var type0" id="S4T0U35">n</span>/2+1:<span class="var type0" id="S4T0U38">n</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="var type0" id="S8T0U41">M</span> = <span class="message error" id="M4F1C"><span class="var type1" id="S3T1U43">u</span>.M</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="var type0" id="S9T0U47">C</span> = <span class="message error" id="M5F1C"><span class="var type1" id="S3T1U49">u</span>.C</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="var type0" id="S10T0U53">K</span> = <span class="message error" id="M6F1C"><span class="var type1" id="S3T1U55">u</span>.K</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="var type0" id="S11T0U59">U</span> = <span class="message error" id="M7F1C"><span class="var type1" id="S3T1U61">u</span>.input</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="var type0" id="S12T0U65">phi_Q</span>   = <span class="var type0" id="S6T0U67"><span class="message error" id="M8F1C">x</span></span>(4);</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="var type0" id="S13T0U71">theta_Q</span> = <span class="var type0" id="S6T0U73"><span class="message error" id="M9F1C">x</span></span>(5);</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="var type0" id="S14T0U77">psi_Q</span>   = <span class="var type0" id="S6T0U79"><span class="message error" id="M10F1C">x</span></span>(6);</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="var type0" id="S15T0U83">rotX</span> = [<span class="mxinfo " id="T2:U10"><span class="mxinfo " id="T3:U11">1</span>       <span class="mxinfo " id="T3:U12">0</span>          <span class="mxinfo " id="T3:U13">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T3:U14">0</span> cos(<span class="var type0" id="S12T0U93"><span class="message error" id="M11F1C">phi_Q</span></span>) -sin(<span class="var type0" id="S12T0U97">phi_Q</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">    0 sin(<span class="var type0" id="S12T0U102">phi_Q</span>)  cos(<span class="var type0" id="S12T0U105">phi_Q</span>)];</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="var type0" id="S18T0U108">rotY</span> = [cos(<span class="var type0" id="S13T0U113"><span class="message error" id="M12F1C">theta_Q</span></span>)   0 sin(<span class="var type0" id="S13T0U117">theta_Q</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    0            1          0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    -sin(<span class="var type0" id="S13T0U126">theta_Q</span>)  0 cos(<span class="var type0" id="S13T0U130">theta_Q</span>)];</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="var type0" id="S19T0U133">rotZ</span> = [cos(<span class="var type0" id="S14T0U138"><span class="message error" id="M13F1C">psi_Q</span></span>) -sin(<span class="var type0" id="S14T0U142">psi_Q</span>) 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    sin(<span class="var type0" id="S14T0U147">psi_Q</span>)  cos(<span class="var type0" id="S14T0U150">psi_Q</span>) 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    0         0 1];</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="var type0" id="S20T0U158">R_IB</span> = <span class="var type0" id="S19T0U161"><span class="message error" id="M14F1C">rotZ</span></span>*<span class="var type0" id="S18T0U162">rotY</span>*<span class="var type0" id="S15T0U163">rotX</span>;                  <span class="comment">%multi-rotor rotation matrix (coordinate I-&gt;B: x_Q_I = R_Q_IB*x_Q_B)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="var type0" id="S21T0U166">input_transform_thrust</span> = <span class="var type0" id="S20T0U168"><span class="message error" id="M15F1C">R_IB</span></span>*[0 0 <span class="var type0" id="S11T0U175">U</span>(1)].';</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="var type0" id="S22T0U179">input_transform_moment</span> = [<span class="mxinfo " id="T3:U15">1</span>             sin(<span class="var type0" id="S12T0U187"><span class="message error" id="M16F1C">phi_Q</span></span>)*tan(<span class="var type0" id="S13T0U190">theta_Q</span>)  cos(<span class="var type0" id="S12T0U194">phi_Q</span>)*tan(<span class="var type0" id="S13T0U197">theta_Q</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">                          cos(<span class="var type0" id="S12T0U201">phi_Q</span>)    0                       -sin(<span class="var type0" id="S12T0U206">phi_Q</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">                          0             sin(<span class="var type0" id="S12T0U212">phi_Q</span>)*sec(<span class="var type0" id="S13T0U215">theta_Q</span>)  cos(<span class="var type0" id="S12T0U219">phi_Q</span>)*sec(<span class="var type0" id="S13T0U222">theta_Q</span>)]*<span class="var type0" id="S11T0U224">U</span>(2:4);</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="comment">%TODO: acceleration relationship must be comptued in detail</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">                      </span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="var type0" id="S2T0U230">y</span> = <span class="var type0" id="S8T0U232"><span class="message error" id="M17F1C">M</span></span>\([<span class="var type0" id="S21T0U239">input_transform_thrust</span>; <span class="var type0" id="S22T0U242">input_transform_moment</span>(2:4); 0 0].' - <span class="var type0" id="S9T0U250">C</span>*<span class="var type0" id="S7T0U251">x_dot</span> - <span class="var type0" id="S10T0U252">K</span>);</span></span>
</pre>
